<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>标题</title>
    <!-- import element-ui's stylesheet -->
    <link
      rel="stylesheet"
      type="text/css"
      href="./import/element-ui/element.css"
    />
    <!-- your stylesheet -->
    <link rel="stylesheet" type="text/css" href="./static/css/index.css" />
  </head>

  <body>
    <div id="app">
      <el-form ref="form" :model="form" label-width="80px">
        <el-form-item label="公钥">
          <el-input
            type="textarea"
            v-model="form.pubKey"
            :autosize="{ minRows: 2, maxRows: 8}"
          ></el-input>
        </el-form-item>

        <el-form-item label="订单号">
          <el-input v-model="form.orderId"></el-input>
        </el-form-item>

        <el-form-item label="交易号">
          <el-input v-model="form.txId"></el-input>
        </el-form-item>

        <el-form-item>
          <el-button type="primary" @click="signature">签名</el-button>
        </el-form-item>

        <el-form-item label="Message">
          <el-input v-model="form.message"></el-input>
        </el-form-item>

        <el-form-item label="Sign">
          <el-input v-model="form.sign"></el-input>
        </el-form-item>

        <el-form-item>
          <el-button type="primary" @click="store">存储</el-button>
        </el-form-item>

        <el-form-item label="Key">
          <el-input type="textarea" v-model="form.key"></el-input>
        </el-form-item>
      </el-form>
    </div>
  </body>

  <!-- import Vue before Element -->
  <script src="./import/vue.js"></script>
  <!-- import Axios -->
  <script src="./import/axios.min.js"></script>
  <!-- import JavaScript -->
  <script src="./import/element-ui/element.js"></script>

  <!-- load configurations -->
  <script src="./config.js"></script>

  <!-- your script -->
  <script src="./static/js/index.js"></script>

  <!-- run main scripts -->
  <script>
    document.title = Title;

    const instance = axios.create({
      baseURL: baseURL,
      timeout: 6000,
    });

    new Vue({
      el: "#app",
      data: function () {
        return {
          form: {
            pubKey: "",
            orderId: "",
            txId: "",
            message: "",
            sign: "",
            key: "",
          },
        };
      },
      methods: {
        getPubkey() {
          axios
            .get("http://localhost:8080/public_key")
            .then( (response)=> {
              // 处理成功情况
              this.form.pubKey = response.data.public_key;
              console.log(this.form.pubKey)
              console.log(response.data)
            })
            .catch(function (error) {
              // 处理错误情况
              console.log(error)
            });
        },
        signature() {
          let that=this
          axios
            .post("http://localhost:8080/sign", {
              out_trade_no: this.form.orderId,
              trade_no: this.form.txId,
            })
            .then(function (response) {
              console.log(response);
              that.form.message = response.data.message;
              that.form.sign = response.data.sign;
            })
            .catch(function (error) {
              console.log(error);
            });
        },
        store() {
          axios
            .post("http://localhost:8080/upload", {
              out_trade_no: this.form.orderId,
              trade_no: this.form.txId,
              sign: this.form.sign
            })
            .then((response)=> {
              console.log(response);
              this.form.key = response.data.key;
            })
            .catch(function (error) {
              console.log(error);
            });
        },
      },
      mounted() {
        this.getPubkey();
      },
    });
  </script>
</html>
